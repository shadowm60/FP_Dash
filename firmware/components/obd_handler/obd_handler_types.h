#ifndef _OBD_HANDLER_TYPES_
#define _OBD_HANDLER_TYPES_

#include <stdio.h>
#include <stdlib.h>
#include <stdint.h>

//https://en.wikipedia.org/wiki/OBD-II_PIDs

typedef enum {
    CURENT_DATA  = 0x01,
    FREEZ_FRAME  = 0x02,
    STORED_DTCS  = 0x03,
    CLEAR_DTCS   = 0x04,
    TEST_O2      = 0x05,
    TEST_OTHER   = 0x06,
    PENDING_DTCS = 0x07,
    CONTROL_OP   = 0x08,
    REQ_VEH_INFO = 0x09,
    PREM_DTC     = 0x0A
}obd_service;

typedef enum {
    PID_00_SUPPORTED_01_20 = 0x00,
    PID_01_MONITOR_STATUS_SINCE_DTC = 0x01,
    PID_02_FREEZE_FRAME_DTC = 0x02,
    PID_03_FUEL_SYSTEM_STATUS = 0x03,
    PID_04_ENGINE_LOAD = 0x04,
    PID_05_COOLANT_TEMP = 0x05,
    PID_06_STFT_BANK1 = 0x06,
    PID_07_LTFT_BANK1 = 0x07,
    PID_08_STFT_BANK2 = 0x08,
    PID_09_LTFT_BANK2 = 0x09,
    PID_0A_FUEL_PRESSURE = 0x0A,
    PID_0B_INTAKE_PRESSURE = 0x0B,
    PID_0C_ENGINE_RPM = 0x0C,
    PID_0D_VEHICLE_SPEED = 0x0D,
    PID_0E_TIMING_ADVANCE = 0x0E,
    PID_0F_INTAKE_TEMP = 0x0F,
    PID_10_MAF_FLOW_RATE = 0x10,
    PID_11_THROTTLE_POS = 0x11,
    PID_12_SECONDARY_AIR_STATUS = 0x12,
    PID_13_O2_SENSORS_PRESENT_2BANKS = 0x13,
    PID_14_O2_SENSOR1 = 0x14,
    PID_15_O2_SENSOR2 = 0x15,
    PID_16_O2_SENSOR3 = 0x16,
    PID_17_O2_SENSOR4 = 0x17,
    PID_18_O2_SENSOR5 = 0x18,
    PID_19_O2_SENSOR6 = 0x19,
    PID_1A_O2_SENSOR7 = 0x1A,
    PID_1B_O2_SENSOR8 = 0x1B,
    PID_1C_OBD_STANDARDS = 0x1C,
    PID_1D_O2_SENSORS_PRESENT_4BANKS = 0x1D,
    PID_1E_AUX_INPUT_STATUS = 0x1E,
    PID_1F_RUNTIME_SINCE_START = 0x1F,
    PID_20_SUPPORTED_21_40 = 0x20,
    PID_21_DISTANCE_WITH_MIL = 0x21,
    PID_22_FUEL_RAIL_PRESSURE_VAC = 0x22,
    PID_23_FUEL_RAIL_PRESSURE_DIRECT = 0x23,
    PID_24_O2_SENSOR1_LAMBDA_VOLT = 0x24,
    PID_25_O2_SENSOR2_LAMBDA_VOLT = 0x25,
    PID_26_O2_SENSOR3_LAMBDA_VOLT = 0x26,
    PID_27_O2_SENSOR4_LAMBDA_VOLT = 0x27,
    PID_28_O2_SENSOR5_LAMBDA_VOLT = 0x28,
    PID_29_O2_SENSOR6_LAMBDA_VOLT = 0x29,
    PID_2A_O2_SENSOR7_LAMBDA_VOLT = 0x2A,
    PID_2B_O2_SENSOR8_LAMBDA_VOLT = 0x2B,
    PID_2C_COMMANDED_EGR = 0x2C,
    PID_2D_EGR_ERROR = 0x2D,
    PID_2E_EVAP_PURGE = 0x2E,
    PID_2F_FUEL_TANK_LEVEL = 0x2F,
    PID_30_WARMUPS_SINCE_CLEAR = 0x30,
    PID_31_DISTANCE_SINCE_CLEAR = 0x31,
    PID_32_EVAP_PRESSURE = 0x32,
    PID_33_BAROMETRIC_PRESSURE = 0x33,
    PID_34_O2_SENSOR1_LAMBDA_CURRENT = 0x34,
    PID_35_O2_SENSOR2_LAMBDA_CURRENT = 0x35,
    PID_36_O2_SENSOR3_LAMBDA_CURRENT = 0x36,
    PID_37_O2_SENSOR4_LAMBDA_CURRENT = 0x37,
    PID_38_O2_SENSOR5_LAMBDA_CURRENT = 0x38,
    PID_39_O2_SENSOR6_LAMBDA_CURRENT = 0x39,
    PID_3A_O2_SENSOR7_LAMBDA_CURRENT = 0x3A,
    PID_3B_O2_SENSOR8_LAMBDA_CURRENT = 0x3B,
    PID_3C_CAT_TEMP_B1S1 = 0x3C,
    PID_3D_CAT_TEMP_B2S1 = 0x3D,
    PID_3E_CAT_TEMP_B1S2 = 0x3E,
    PID_3F_CAT_TEMP_B2S2 = 0x3F,
    PID_40_SUPPORTED_41_60 = 0x40,
    PID_41_MONITOR_STATUS_THIS_CYCLE = 0x41,
    PID_42_CONTROL_MODULE_VOLTAGE = 0x42,
    PID_43_ABSOLUTE_LOAD = 0x43,
    PID_44_COMMANDED_EQUIV_RATIO = 0x44,
    PID_45_RELATIVE_THROTTLE_POS = 0x45,
    PID_46_AMBIENT_TEMP = 0x46,
    PID_47_ABS_THROTTLE_POS_B = 0x47,
    PID_48_ABS_THROTTLE_POS_C = 0x48,
    PID_49_ACCEL_POS_D = 0x49,
    PID_4A_ACCEL_POS_E = 0x4A,
    PID_4B_ACCEL_POS_F = 0x4B,
    PID_4C_COMMANDED_THROTTLE_ACTUATOR = 0x4C,
    PID_4D_TIME_MIL_ON = 0x4D,
    PID_4E_TIME_SINCE_CLEAR = 0x4E,
    PID_4F_MAX_EQUIV_RATIO_VOLT_CURR_PRESS = 0x4F,
    PID_50_MAX_MAF_FLOW_RATE = 0x50,
    PID_51_FUEL_TYPE = 0x51,
    PID_52_ETHANOL_PERCENT = 0x52,
    PID_53_ABS_EVAP_PRESSURE = 0x53,
    PID_54_EVAP_PRESSURE_ALT = 0x54,
    PID_55_STFT_O2_TRIM_B1_B3 = 0x55,
    PID_56_LTFT_O2_TRIM_B1_B3 = 0x56,
    PID_57_STFT_O2_TRIM_B2_B4 = 0x57,
    PID_58_LTFT_O2_TRIM_B2_B4 = 0x58,
    PID_59_FUEL_RAIL_ABS_PRESSURE = 0x59,
    PID_5A_REL_ACCEL_POS = 0x5A,
    PID_5B_HYBRID_BATTERY_LIFE = 0x5B,
    PID_5C_ENGINE_OIL_TEMP = 0x5C,
    PID_5D_FUEL_INJECTION_TIMING = 0x5D,
    PID_5E_ENGINE_FUEL_RATE = 0x5E,
    PID_5F_EMISSION_REQUIREMENTS = 0x5F,
    PID_60_SUPPORTED_61_80 = 0x60,
    PID_61_ENGINE_TORQUE_DRIVER_DEMAND = 0x61,
    PID_62_ENGINE_TORQUE_ACTUAL = 0x62,
    PID_63_ENGINE_REFERENCE_TORQUE = 0x63,
    PID_64_ENGINE_TORQUE_DATA = 0x64,
    PID_65_AUX_IO_SUPPORTED = 0x65,
    PID_66_MAF_SENSOR_DATA = 0x66,
    PID_67_COOLANT_TEMP_SENSORS = 0x67,
    PID_68_INTAKE_TEMP_SENSORS = 0x68,
    PID_69_EGR_COMMANDED_ACTUAL_ERROR = 0x69,
    PID_6A_DIESEL_INTAKE_FLOW_CONTROL = 0x6A,
    PID_6B_EGR_TEMPERATURE = 0x6B,
    PID_6C_THROTTLE_ACTUATOR_CONTROL = 0x6C,
    PID_6D_FUEL_PRESSURE_CONTROL = 0x6D,
    PID_6E_INJECTION_PRESSURE_CONTROL = 0x6E,
    PID_6F_TURBO_INLET_PRESSURE = 0x6F,
    PID_70_BOOST_PRESSURE_CONTROL = 0x70,
    PID_71_VGT_CONTROL = 0x71,
    PID_72_WASTEGATE_CONTROL = 0x72,
    PID_73_EXHAUST_PRESSURE = 0x73,
    PID_74_TURBOCHARGER_RPM = 0x74,
    PID_75_TURBO_TEMP_1 = 0x75,
    PID_76_TURBO_TEMP_2 = 0x76,
    PID_77_CHARGE_AIR_COOLER_TEMP = 0x77,
    PID_78_EGT_BANK1 = 0x78,
    PID_79_EGT_BANK2 = 0x79,
    PID_7A_DPF_DIFFERENTIAL_PRESSURE = 0x7A,
    PID_7B_DPF_DATA = 0x7B,
    PID_7C_DPF_TEMPERATURE = 0x7C,
    PID_7D_NOX_NTE_STATUS = 0x7D,
    PID_7E_PM_NTE_STATUS = 0x7E,
    PID_7F_ENGINE_RUNTIME = 0x7F,
    PID_80_SUPPORTED_81_A0 = 0x80,
    PID_81_AECD_RUNTIME_1 = 0x81,
    PID_82_AECD_RUNTIME_2 = 0x82,
    PID_83_NOX_SENSOR = 0x83,
    PID_84_MANIFOLD_SURFACE_TEMP = 0x84,
    PID_85_NOX_REAGENT_SYSTEM = 0x85,
    PID_86_PM_SENSOR = 0x86,
    PID_87_INTAKE_MANIFOLD_PRESSURE = 0x87,
    PID_88_SCR_INDUCE_SYSTEM = 0x88,
    PID_89_AECD_RUNTIME_11_15 = 0x89,
    PID_8A_AECD_RUNTIME_16_20 = 0x8A,
    PID_8B_DIESEL_AFTERTREATMENT = 0x8B,
    PID_8C_O2_SENSOR_WIDE_RANGE = 0x8C,
    PID_8D_THROTTLE_POSITION_G = 0x8D,
    PID_8E_ENGINE_FRICTION_TORQUE = 0x8E,
    PID_8F_PM_SENSOR_BANK1_2 = 0x8F,
    PID_90_WWH_OBD_SYSTEM_INFO_1 = 0x90,
    PID_91_WWH_OBD_SYSTEM_INFO_2 = 0x91,
    PID_92_FUEL_SYSTEM_CONTROL = 0x92,
    PID_93_WWH_OBD_COUNTERS_SUPPORT = 0x93,
    PID_94_NOX_WARNING_INDUCEMENT = 0x94,
    PID_98_EGT_SENSOR_1 = 0x98,
    PID_99_EGT_SENSOR_2 = 0x99,
    PID_9A_HYBRID_EV_BATTERY_VOLTAGE = 0x9A,
    PID_9B_DEF_SENSOR_DATA = 0x9B,
    PID_9C_O2_SENSOR_DATA = 0x9C,
    PID_9D_ENGINE_FUEL_RATE_GPS = 0x9D,
    PID_9E_ENGINE_EXHAUST_FLOW_RATE = 0x9E,
    PID_9F_FUEL_SYSTEM_PERCENTAGE_USE = 0x9F,
    PID_A0_SUPPORTED_A1_C0 = 0xA0,
    PID_A1_NOX_SENSOR_CORRECTED = 0xA1,
    PID_A2_CYLINDER_FUEL_RATE = 0xA2,
    PID_A3_EVAP_PRESSURE = 0xA3,
    PID_A4_TRANSMISSION_ACTUAL_GEAR = 0xA4,
    PID_A5_DEF_DOSING_COMMAND = 0xA5,
    PID_A6_ODOMETER = 0xA6,
    PID_A7_NOX_SENSOR_3_4 = 0xA7,
    PID_A8_NOX_SENSOR_CORRECTED_3_4 = 0xA8,
    PID_A9_ABS_DISABLE_SWITCH = 0xA9,
    PID_C0_SUPPORTED_C1_E0 = 0xC0,
    PID_C3_FUEL_LEVEL_INPUT_AB = 0xC3,
    PID_C4_EXHAUST_PARTICULATE_DIAG_TIME = 0xC4,
    PID_C5_FUEL_PRESSURE_AB = 0xC5,
    PID_C6_PARTICULATE_CONTROL_STATUS = 0xC6,
    PID_C7_DISTANCE_SINCE_REFLASH = 0xC7,
    PID_C8_NOX_PARTICULATE_WARNING_LAMP = 0xC8
} ObdPidService01;

typedef struct {
	uint8_t FuelSystemStatus; 
	uint8_t EngineLoad; 			//in %0..100
	int16_t EngineCLT; 		    	// -40 .. 215 Â°C
	
	
} ObdEngineParams;

typedef void (*ObdPidHandler)(uint16_t size, uint8_t *data);


#define MAX_DESC_LEN    40

// fuel system status
#define ENGINE_OFF 				0x00 
#define OPEN_LOOP_ENGINE_COLD	0x01
#define CLOSED_LOOP_OK			0x02
#define OPEN_LOOP_LOAD_OR_CUT   0x04
#define OPEN_LOOP_SYS_FAULT     0x08
#define CLOSED_LOOP_WITH_ERR    0x10

// control status encoding
#define NO_DATA         0x00
#define IS_SUPPORTED    0x01
#define IS_UPDATED      0x02
#define IS_CYCLIC       0x04
#define IS_DISCOVERY    0x08
#define IS_BUSY         0x10

typedef struct {
    uint32_t timeStamp;
    ObdPidService01 pid; 
    uint8_t pid_data_len;
    uint8_t control; // check defines above
    ObdPidHandler handler;
    char description[MAX_DESC_LEN]; //short description used for gui later
} ObdPidServiceData;

#endif